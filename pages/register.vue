<template>
  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö -->
  <div class="flex justify-start ml-5 mt-5">
    <button
      @click="goBack"
      class="text-white bg-[#A73B24] opacity-80 px-3 py-1 rounded-lg shadow-xl"
    >
      Back
    </button>
  </div>
  <div
    class="flex flex-col items-center bg-white p-6 max-lg:mt-8 max-sm:mt-6 font-serif"
  >
    <button>
      <svg
        class="w-6 h-6 text-gray-800 dark:text-white"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        fill="none"
        viewBox="0 0 24 24"
      >
        <path
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5 12h14M5 12l4-4m-4 4 4 4"
        />
      </svg>
    </button>

    <!-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ -->
    <!-- <h1 class="text-3xl font-bold text-black">KhonKaen</h1>
    <p class="text-lg font-semibold text-black">University</p> -->

    <h2 class="text-center text-xl text-black font-semibold">Register</h2>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô -->
    <div class="max-w-lg md:max-w-2xl lg:max-w-3xl mx-auto px-10">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
        <div>
          <label for="firstname" class="block text-black font-normal mb-1">
            ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á :
          </label>
          <input
            type="text"
            id="firstname"
            v-model="registers.firstname"
            class="w-full px-4 py-2 rounded-2xl bg-gray-200 focus:outline-none"
            required
            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠"
          />
        </div>

        <div>
          <label for="lastname" class="block text-black font-normal mb-1">
            ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• :
          </label>
          <input
            type="text"
            id="lastname"
            v-model="registers.lastname"
            class="w-full px-4 py-2 rounded-2xl bg-gray-200 focus:outline-none"
            required
            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
          />
        </div>

        <div>
          <label for="nickname" class="block text-black font-normal mb-1">
            ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô :
          </label>
          <input
            type="text"
            id="nickname"
            v-model="registers.nickname"
            class="w-full px-4 py-2 rounded-2xl bg-gray-200 focus:outline-none"
            required
            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô"
          />
        </div>

        <div>
          <label for="email" class="block text-black font-normal mb-1">
            ‡∏≠‡∏µ‡πÄ‡∏°‡∏• :
          </label>
          <input
            type="text"
            id="email"
            v-model="registers.email"
            class="w-full px-4 py-2 rounded-2xl bg-gray-200 focus:outline-none"
            required
            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•"
          />
        </div>

        <div>
          <label for="student_id" class="block text-black font-normal mb-1">
            ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ :
          </label>
          <input
            type="text"
            id="student_id"
            v-model="registers.student_id"
            class="w-full px-4 py-2 rounded-2xl bg-gray-200 focus:outline-none"
            required
            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤"
          />
        </div>

        <div>
          <label for="faculty" class="block text-black font-normal mb-1">
            ‡∏Ñ‡∏ì‡∏∞ :
          </label>
          <input
            type="text"
            id="faculty"
            v-model="registers.faculty"
            class="w-full px-4 py-2 rounded-2xl bg-gray-200 focus:outline-none"
            required
            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏ì‡∏∞"
          />
        </div>

        <div>
          <label
            for="medical_condition"
            class="block text-black font-normal mb-1"
          >
            ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß :
          </label>
          <input
            type="text"
            id="medical_condition"
            v-model="registers.medical_condition"
            class="w-full px-4 py-2 rounded-2xl bg-gray-200 focus:outline-none"
            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
          />
        </div>

        <div>
          <label for="food_allergies" class="block text-black font-normal mb-1">
            ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏û‡πâ :
          </label>
          <input
            type="text"
            id="food_allergies"
            v-model="registers.food_allergies"
            class="w-full px-4 py-2 rounded-2xl bg-gray-200 focus:outline-none"
            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
          />
        </div>
      </div>

      <div class="flex justify-center mt-14">
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô -->
        <button
          type="submit"
          class="text-lg px-10 py-3 bg-[#A73B24] text-white rounded-2xl hover:bg-[#A73B24] transition cursor-pointer"
          @click="register"
        >
          ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
        </button>
      </div>

      <div class="border-t mt-14">
        <p class="text-gray-800 text-m flex justify-center mt-5">
          ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß ?
          <NuxtLink
            to="/login"
            class="hover:text-[#A73B24] text-red-600 cursor-pointer mx-3"
          >
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
          </NuxtLink>
        </p>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import Swal from "sweetalert2";
import type { Register } from "@/models/page.model";
import * as services from "@/services/auth.service";

definePageMeta({
  layout: "auth",
});

const router = useRouter();
const registers = ref<Register>({
  firstname: "",
  lastname: "",
  nickname: "",
  email: "",
  student_id: "",
  faculty: "",
  medical_condition: "",
  food_allergies: "",
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
const goBack = () => {
  router.push("/");
};

const register = async () => {
  // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (9 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç + "-" + 1 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)
  const studentIdPattern = /^\d{9}-\d$/;
  if (!studentIdPattern.test(registers.value.student_id)) {
    Swal.fire({
      title: "‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!",
      text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô 643120391-7",
      icon: "warning",
      confirmButtonText: "‡∏ï‡∏Å‡∏•‡∏á",
    });
    return;
  }

  // ‚úÖ Popup ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
  const confirmRegister = await Swal.fire({
    title: "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
    html: `‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <b>${registers.value.student_id}</b> <br><br>‚ùóÔ∏è <b>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß <u>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ</u></b> ‚ùóÔ∏è`,
    icon: "info",
    showCancelButton: true,
    confirmButtonText: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
    cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
  });

  if (!confirmRegister.isConfirmed) {
    return;
  }

  // ‚úÖ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
  try {
    const resp = await services.register(registers.value);
    console.log(resp);

    if (resp.status == 200) {
      Swal.fire({
        title: "üéâ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
        text: "‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß.",
        icon: "success",
        confirmButtonText: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö",
      }).then(() => {
        router.push("/login");
      });
    }
  } catch (error) {
    console.error(error);
    Swal.fire({
      title: "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!",
      text: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á.",
      icon: "error",
      confirmButtonText: "‡∏ï‡∏Å‡∏•‡∏á",
    });
  }
};
</script>

<style scoped>
/* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô */
</style>
